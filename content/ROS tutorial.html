<!DOCTYPE html><html>
        <head>
        <title>cmsite</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 客製化關閉 -->
        <!--
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        -->
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container">
                <div class="row align-items-center">
                <h1>cmsite</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">cmsite</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='CoppeliaSim User Manual.html'>CoppeliaSim User Manual</a><li class='has-children'><a href='User interface.html'>User interface</a><ul class='dropdown'><li><a href='Pages and views.html'>Pages and views</a><li><a href='Positionorientation manipulation.html'>Positionorientation manipulation</a><li><a href='Position dialog.html'>Position dialog</a><li><a href='Orientation dialog.html'>Orientation dialog</a><li><a href='Object movement via the mouse.html'>Object movement via the mouse</a><li><a href='On positions, orientations and transformations.html'>On positions, orientations and transformations</a><li><a href='User settings.html'>User settings</a><li><a href='Shortcuts.html'>Shortcuts</a></li></ul><li class='has-children'><a href='Scenes and models.html'>Scenes and models</a><ul class='dropdown'><li><a href='Scenes.html'>Scenes</a><li><a href='Models.html'>Models</a><li><a href='Model dialog.html'>Model dialog</a></li></ul><li class='has-children'><a href='Environment.html'>Environment</a><ul class='dropdown'><li><a href='Environment dialog.html'>Environment dialog</a><li><a href='Texture dialog.html'>Texture dialog</a></li></ul><li class='has-children'><a href='Entities.html'>Entities</a><ul class='dropdown'><li><a href='Collections.html'>Collections</a><li class='has-children'><a href='Scene objects.html'>Scene objects</a><ul class='dropdown'><li><a href='Object properties.html'>Object properties</a><li><a href='Object common properties.html'>Object common properties</a></li></ul><li><a href='Collidable objects.html'>Collidable objects</a><li><a href='Measurable objects.html'>Measurable objects</a><li><a href='Detectable objects.html'>Detectable objects</a><li><a href='Viewable objects.html'>Viewable objects</a><li><a href='Convex hull.html'>Convex hull</a><li class='has-children'><a href='Layer selection dialog.html'>Layer selection dialog</a><ul class='dropdown'><li><a href='Cameras.html'>Cameras</a><li><a href='Camera properties.html'>Camera properties</a><li><a href='Lights.html'>Lights</a><li><a href='Light properties.html'>Light properties</a><li><a href='Shapes.html'>Shapes</a><li><a href='Shape coordinate frame.html'>Shape coordinate frame</a><li><a href='Primitive shapes.html'>Primitive shapes</a><li><a href='Convex decomposition.html'>Convex decomposition</a><li><a href='Shape properties.html'>Shape properties</a><li><a href='Shape dynamics properties.html'>Shape dynamics properties</a><li><a href='Material properties.html'>Material properties</a><li><a href='Shape geometry dialog.html'>Shape geometry dialog</a><li><a href='Shape edit modes.html'>Shape edit modes</a><li><a href='Triangle edit mode.html'>Triangle edit mode</a><li><a href='Vertex edit mode.html'>Vertex edit mode</a><li><a href='Edge edit mode.html'>Edge edit mode</a><li><a href='Edit mode for compound shapes.html'>Edit mode for compound shapes</a><li><a href='Joints.html'>Joints</a><li><a href='Joint modes.html'>Joint modes</a><li><a href='Joint properties.html'>Joint properties</a><li><a href='Joint dynamics properties.html'>Joint dynamics properties</a><li><a href='Dynamics engines properties related to joints.html'>Dynamics engines properties related to joints</a><li><a href='Dummies.html'>Dummies</a><li><a href='Dummy properties.html'>Dummy properties</a><li><a href='Graphs.html'>Graphs</a><li><a href='Graph properties.html'>Graph properties</a><li><a href='Proximity sensors.html'>Proximity sensors</a><li><a href='Proximity sensor types and mode of operation.html'>Proximity sensor types and mode of operation</a><li><a href='Proximity sensor properties.html'>Proximity sensor properties</a><li><a href='Proximity sensor volume dialog.html'>Proximity sensor volume dialog</a><li><a href='Proximity sensor detection parameter dialog.html'>Proximity sensor detection parameter dialog</a><li><a href='Vision sensors.html'>Vision sensors</a><li><a href='Vision sensor types and mode of operation.html'>Vision sensor types and mode of operation</a><li><a href='Vision sensor properties.html'>Vision sensor properties</a><li><a href='Force sensors.html'>Force sensors</a><li><a href='Force sensor property.html'>Force sensor property</a><li><a href='OC trees.html'>OC trees</a><li><a href='OC tree properties.html'>OC tree properties</a><li><a href='Point clouds.html'>Point clouds</a><li><a href='Point cloud properties.html'>Point cloud properties</a></li></ul><li><a href='Paths.html'>Paths</a></li></ul><li class='has-children'><a href='Functionality.html'>Functionality</a><ul class='dropdown'><li><a href='Geometric calculations.html'>Geometric calculations</a><li><a href='Collision detection.html'>Collision detection</a><li class='has-children'><a href='Distance calculation.html'>Distance calculation</a><ul class='dropdown'><li><a href='Geometric plugin.html'>Geometric plugin</a><li><a href='simGeom API reference.html'>simGeom API reference</a><li><a href='Coppelia geometric routines.html'>Coppelia geometric routines</a><li><a href='API reference-1.html'>API reference-1</a></li></ul><li><a href='simIGL API reference.html'>simIGL API reference</a><li><a href='Kinematics.html'>Kinematics</a><li><a href='Basics on IK groups and IK elements.html'>Basics on IK groups and IK elements</a><li class='has-children'><a href='Solving IK and FK for any type of mechanism.html'>Solving IK and FK for any type of mechanism</a><ul class='dropdown'><li><a href='Kinematics plugin.html'>Kinematics plugin</a><li><a href='simIK API reference.html'>simIK API reference</a><li><a href='Coppelia kinematics routines.html'>Coppelia kinematics routines</a><li><a href='API reference-2.html'>API reference-2</a></li></ul><li><a href='Dynamics.html'>Dynamics</a><li class='has-children'><a href='Designing dynamic simulations.html'>Designing dynamic simulations</a><ul class='dropdown'><li><a href='General dynamics properties.html'>General dynamics properties</a><li><a href='Dynamics engines general properties.html'>Dynamics engines general properties</a></li></ul><li><a href='Data visualizationoutput.html'>Data visualizationoutput</a><li><a href='Web-browser based front-end.html'>Web-browser based front-end</a></li></ul><li class='has-children'><a href='Data manipulationtransformation.html'>Data manipulationtransformation</a><ul class='dropdown'><li class='has-children'><a href='Messaginginterfacesconnectivity.html'>Messaginginterfacesconnectivity</a><ul class='dropdown'><li><a href='Remote API.html'>Remote API</a><li><a href='ZeroMQ remote API.html'>ZeroMQ remote API</a><li><a href='WebSocket remote API.html'>WebSocket remote API</a><li><a href='ROS Interfaces.html'>ROS Interfaces</a><li><a href='ROS Interface.html'>ROS Interface</a><li><a href='simROS API reference.html'>simROS API reference</a><li><a href='ROS 2 Interface.html'>ROS 2 Interface</a><li><a href='simROS2 API reference.html'>simROS2 API reference</a></li></ul><li><a href='simZMQ API reference.html'>simZMQ API reference</a><li><a href='simWS API reference.html'>simWS API reference</a></li></ul><li class='has-children'><a href='Pathstrajectories.html'>Pathstrajectories</a><ul class='dropdown'><li><a href='Path planning.html'>Path planning</a><li><a href='simOMPL API reference.html'>simOMPL API reference</a><li><a href='Synthetic vision.html'>Synthetic vision</a><li><a href='simIM API reference.html'>simIM API reference</a><li><a href='simVision API reference.html'>simVision API reference</a><li><a href='Custom user interfaces.html'>Custom user interfaces</a><li><a href='simUI API reference.html'>simUI API reference</a><li><a href='simUI XML syntax.html'>simUI XML syntax</a><li><a href='simQML API reference.html'>simQML API reference</a><li><a href='Importexport.html'>Importexport</a><li class='has-children'><a href='XML format.html'>XML format</a><ul class='dropdown'><li><a href='URDF format.html'>URDF format</a><li><a href='simURDF API reference.html'>simURDF API reference</a><li><a href='SDF format.html'>SDF format</a><li><a href='simSDF API reference.html'>simSDF API reference</a></li></ul><li><a href='Video exporter.html'>Video exporter</a><li><a href='simAssimp API reference.html'>simAssimp API reference</a><li class='has-children'><a href='simGLTF API reference.html'>simGLTF API reference</a><ul class='dropdown'><li><a href='Commandssetting.html'>Commandssetting</a><li><a href='simLuaCmd API reference.html'>simLuaCmd API reference</a><li><a href='Miscellaneous.html'>Miscellaneous</a><li><a href='simSurfRec API reference.html'>simSurfRec API reference</a><li><a href='simICP API reference.html'>simICP API reference</a><li><a href='simSubprocess API reference.html'>simSubprocess API reference</a></li></li></ul></ul><li class='has-children'><a href='Writing code in and around CoppeliaSim.html'>Writing code in and around CoppeliaSim</a><ul class='dropdown'><li class='has-children'><a href='Scripts.html'>Scripts</a><ul class='dropdown'><li><a href='Embedded scripts.html'>Embedded scripts</a><li><a href='Simulation scripts.html'>Simulation scripts</a><li><a href='The main script.html'>The main script</a><li><a href='Child scripts.html'>Child scripts</a><li><a href='Customization scripts.html'>Customization scripts</a><li><a href='Script dialog.html'>Script dialog</a><li><a href='Script editor.html'>Script editor</a></li></ul><li><a href='Add-ons.html'>Add-ons</a><li><a href='The sandbox script.html'>The sandbox script</a><li><a href='Script execution order.html'>Script execution order</a><li class='has-children'><a href='Threaded and non-threaded script code.html'>Threaded and non-threaded script code</a><ul class='dropdown'><li><a href='Callback functions.html'>Callback functions</a><li><a href='Dynamics callback functions.html'>Dynamics callback functions</a><li><a href='Joint callback functions.html'>Joint callback functions</a><li><a href='Contact callback function.html'>Contact callback function</a><li><a href='Vision callback functions.html'>Vision callback functions</a><li><a href='Trigger callback functions.html'>Trigger callback functions</a><li><a href='User config callback functions.html'>User config callback functions</a></li></ul><li><a href='Lua vs Python scripts.html'>Lua vs Python scripts</a><li><a href='Lua crash course.html'>Lua crash course</a><li><a href='Plugins.html'>Plugins</a><li><a href='The main client application.html'>The main client application</a><li><a href='Accessing scene objects programmatically.html'>Accessing scene objects programmatically</a><li><a href='Explicit and non-explicit calls.html'>Explicit and non-explicit calls</a><li><a href='CoppeliaSim API framework.html'>CoppeliaSim API framework</a><li><a href='Regular API reference.html'>Regular API reference</a><li><a href='Regular API constants.html'>Regular API constants</a><li><a href='Object parameter IDs.html'>Object parameter IDs</a></li></ul><li class='has-children'><a href='Simulation.html'>Simulation</a><ul class='dropdown'><li><a href='Simulation settings dialog.html'>Simulation settings dialog</a></li></ul><li class='has-children'><a href='Tutorials.html'>Tutorials</a><ul class='dropdown'><li><a href='BubbleRob tutorial.html'>BubbleRob tutorial</a><li><a href='Building a clean model tutorial.html'>Building a clean model tutorial</a><li><a href='Line following BubbleRob tutorial.html'>Line following BubbleRob tutorial</a><li><a href='Inverse kinematics tutorial.html'>Inverse kinematics tutorial</a><li><a href='External controller tutorial.html'>External controller tutorial</a><li><a href='Plugin tutorial.html'>Plugin tutorial</a><li><a href='Robot language interpreter integration tutorial.html'>Robot language interpreter integration tutorial</a><li><a href='ROS tutorials.html'>ROS tutorials</a><li><a href='ROS tutorial.html'>ROS tutorial</a><li><a href='ROS 2 tutorial.html'>ROS 2 tutorial</a><li><a href='Compiling CoppeliaSim.html'>Compiling CoppeliaSim</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">ROS tutorials << <a href='ROS tutorials.html'>Previous</a> <a href='ROS 2 tutorial.html'>Next</a> >> ROS 2 tutorial<br /><h1>ROS tutorial</h1><div align="center">
<table class="allEncompassingTable">
<tr>
<td>
<p><a href="../index.html" target="_top"><img src="images/homeImg.png"/></a></p>
<h4>ROS tutorial</h4>
<p>This tutorial will try to explain in a simple way how you can manage to have CoppeliaSim <em>ROS enabled</em>, based on <a href="http://wiki.ros.org/melodic">ROS Melodic</a> and <a href="http://catkin-tools.readthedocs.io/en/latest/installing.html">Catkin build</a>.</p>
<p>First of all you should make sure that you have gone through the <a href="http://www.ros.org/wiki/ROS/Tutorials">official ROS tutorials</a>, at least the beginner section, and that you have installed the <a href="http://catkin-tools.readthedocs.io/en/latest/installing.html">Catkin tools</a>. Then, we assume that you have the latest Ubuntu running, that ROS is installed, and that the workspace folders are set. Here also refer to the <a href="http://wiki.ros.org/melodic/Installation/Ubuntu">official documentation regarding the ROS installation</a>.</p>
<p>The general ROS functionality in CoppeliaSim is supported via the <a href="rosInterf.htm">ROS Interface</a> (<em>libsimExtROS.so</em>). The Linux distribution should include that file already compiled in <em>CoppeliaSim/compiledROSPlugins</em>, but it first needs to be copied to <em>CoppeliaSim/</em>, otherwise it won't be loaded. You might however experience plugin load problems, depending on your system specificities: make sure to always inspect the terminal window of CoppeliaSim for details about plugin load operations. Plugins are loaded when CoppeliaSim is launched. The ROS plugin will only successfully load and initialize if <em>roscore</em> is running at that time (<em>roscore</em> is the ROS master). Also make sure to source the ROS environment prior to running CoppeliaSim.</p>
<p>If the plugin cannot be loaded, then you should recompile it by yourself. It is open source and can be modified as much as needed in order to support a specific feature or to extend its functionality. If specific messages/services/etc. need to be supported, make sure to edit files located in <em>simExtROS/meta/</em>, prior to recompilation. There are 2 packages:</p>
<li><a href="https://github.com/CoppeliaRobotics/simExtROS" target="_blank">simExtROS</a>: this package is the <a href="rosInterf.htm">ROS Interface</a> that will be compiled to a ".so" file, and that is used by CoppeliaSim.</li>
<li><a href="https://github.com/CoppeliaRobotics/ros_bubble_rob" target="_blank">ros_bubble_rob</a>: this is the package of a very simple robot controller that connects to CoppeliaSim via the <a href="rosInterf.htm">ROS Interface</a>. This node will be in charge of controlling the  red robot in the demo scene <em>controlTypeExamples/controlledViaRos.ttt</em></li>
<p>Above packages should be copied to your <em>catkin_ws/src</em><em> </em>folder. Make sure that ROS is aware of those packages, i.e. that you can switch to above package folders with:</p>
<code class="hljs coppelia-terminal">
$ roscd sim_ros_interface
$ roscd ros_bubble_rob
</code>
<p>In order to build the packages, navigate to the <em>catkin_ws</em> folder and type:</p>
<code class="hljs coppelia-terminal">
$ export COPPELIASIM_ROOT_DIR=~/path/to/coppeliaSim/folder
$ catkin build --cmake-args -DCMAKE_BUILD_TYPE=Release
</code>
<p>Note for Ubuntu 20.04: due to a bug in python-catkin-tools you need to use catkin_make instead of catkin build.</p>
<p>That's it! The packages should have been generated and compiled to a library. Copy the devel/lib/libsimExtROS.so file to the CoppeliaSim installation folder. The plugin is now ready to be used!</p>
<p>Now open a terminal and start the ROS master with:</p>
<code class="hljs coppelia-terminal">
$ roscore
</code>
<p>Open another terminal, move to the CoppeliaSim installation folder and start CoppeliaSim. This is what you should have (or similar):</p>
<code class="hljs coppelia-terminal">
$ ./coppeliaSim.sh
...
Plugin 'ROSInterface': loading...
Plugin 'ROSInterface': load succeeded.
...
</code>
<p>Upon succesful ROS Interface load, checking the available nodes gives this:</p>
<code class="hljs coppelia-terminal">
$ rosnode list
/rosout
/sim_ros_interface
</code>
<p>In an empty CoppeliaSim scene, select an object, then attach a non-threaded <a href="childScripts.htm">child script</a> to it with [Menu bar --&gt; Add --&gt; Associated child script --&gt; Non threaded]. Open the <a href="scriptEditor.htm">script editor</a> for that script and replace the content with following:</p>
<code class="hljs language-lua coppelia-coppeliasim-script">
function subscriber_callback(msg)
    -- This is the subscriber callback function
    sim.addLog(sim.verbosity_scriptinfos,'subscriber receiver following Float32: '..msg.data)
end

function getTransformStamped(objHandle,name,relTo,relToName)
    -- This function retrieves the stamped transform for a specific object
    t=sim.getSystemTime()
    p=sim.getObjectPosition(objHandle,relTo)
    o=sim.getObjectQuaternion(objHandle,relTo)
    return {
        header={
            stamp=t,
            frame_id=relToName
        },
        child_frame_id=name,
        transform={
            translation={x=p[1],y=p[2],z=p[3]},
            rotation={x=o[1],y=o[2],z=o[3],w=o[4]}
        }
    }
end

function sysCall_init()
    -- The child script initialization
    objectHandle=sim.getObject('.')
    objectAlias=sim.getObjectAlias(objectHandle,3)

    -- Prepare the float32 publisher and subscriber (we subscribe to the topic we advertise):
    if simROS then
        publisher=simROS.advertise('/simulationTime','std_msgs/Float32')
        subscriber=simROS.subscribe('/simulationTime','std_msgs/Float32','subscriber_callback')
    end
end

function sysCall_actuation()
    -- Send an updated simulation time message, and send the transform of the object attached to this script:
    if simROS then
        simROS.publish(publisher,{data=sim.getSimulationTime()})
        simROS.sendTransform(getTransformStamped(objectHandle,objectAlias,-1,'world'))
        -- To send several transforms at once, use simROS.sendTransforms instead
    end
end

function sysCall_cleanup()
    -- Following not really needed in a simulation script (i.e. automatically shut down at simulation end):
    if simROS then
        simROS.shutdownPublisher(publisher)
        simROS.shutdownSubscriber(subscriber)
    end
end</code>
<p>Above script will publish the simulation time, and subscribe to it at the same time. It will also publish the transform of the object the script is attached to. You should be able to see the simulation time topic with:</p>
<code class="hljs coppelia-terminal">
$ rostopic list
</code>
<p>To see the message content, you can type:</p>
<code class="hljs coppelia-terminal">
$ rostopic echo /simulationTime
</code>
<p>Now load the demo scene <em>rosInterfaceTopicPublisherAndSubscriber.ttt</em>, and run the simulation. The code in the <a href="childScripts.htm">child script</a> attached to <em>Vision_sensor</em> will enable a publisher to stream the vision sensor's image, and also enable a subscriber to listen to that same stream. The subscriber applies the read data to the  passive vision sensor, that is only used as a data container. So CoppeliaSim is streaming data, while listening to the same data! This is what is happening:</p>
<p align="center"><img src="images/rosTut1.jpg"/></p>
<p class="imageLabel">[Image publisher and image subscriber demo]</p>
<br/>
<p>Try experimenting a little bit with the code. You can also visualize the image that CoppeliaSim streams with following command:</p>
<code class="hljs coppelia-terminal">
$ rosrun image_view image_view image:=/visionSensorData
</code>
<p>Had you been streaming simpler data, then you could also have visualized it with:</p>
<code class="hljs coppelia-terminal">
$ rostopic echo /visionSensorData
</code>
<p>Now stop the simulation and load the demo scene <em>controlTypeExamples/controlledViaRos.ttt</em>, and run the simulation. The robot is simplistic, and also behaving in a simplistic way for simplification purposes. It is controlled via the <a href="rosInterf.htm">ROS Interface</a>:</p>
<p align="center"><img src="images/rosBubbleRob.jpg"/></p>
<p class="imageLabel">[External client application controlling the  robot via ROS]</p>
<br/>
<p>The child script attached to the  robot, and running in a non-threaded fashion, is in charge of following:</p>
<li>determine some object handles (e.g. motor joint handles and proximity sensor handle)</li>
<li>verify if the ROS Interface is loaded</li>
<li>Launch motor speed subscribers</li>
<li>Launch a sensor publisher and a simulation time publisher</li>
<li> and finally launch a client application. The application is called with some topic names as arguments, so that it will know which topics to listen to and to subscribe. The client application (<em>rosBubbleRob</em>) is then taking over the control of the  robot via ROS.</li>
<p>While simulation is running, copy and paste a few times the   robot. Notice that every copy is directly operational and independent. This is one of the many strengths of CoppeliaSim.</p>
<p>Now stop the simulation and open a new scene, then drag following model into it: <em>Models/tools/rosInterface helper tool.ttm</em>. This model is constituted by a single <a href="customizationScripts.htm">customization script</a> that offers following topic publishers and subscribers:</p>
<li><em>startSimulation</em> topic: can be used to start a simulation by publishing on this topic a <em>std_msgs::Bool</em> message.</li>
<li><em>pauseSimulation</em> topic: can be used to pause a simulation by publishing on this topic a <em>std_msgs::Bool</em> message.</li>
<li><em>stopSimulation</em> topic: can be used to stop a simulation by publishing on this topic a <em>std_msgs::Bool</em> message.</li>
<li><em>enableSyncMode</em> topic: by publishing a <em>std_msgs::Bool</em> message on this topic, you can enable/disable the <a href="simulation.htm#stepped">stepped mode</a>.</li>
<li><em>triggerNextStep</em> topic: by publishing a <em>std_msgs::Bool</em> message on this topic, you can trigger the next simulation step, while in the <a href="simulation.htm#stepped">stepped mode</a>.</li>
<li><em>simulationStepDone</em> topic: a message of type <em>std_msgs::Bool</em> will be published at the end of each simulation pass.</li>
<li><em>simulationState</em> topic: messages of type <em>std_msgs::Int32</em> will be published on a regular basis. <em>0</em> indicates that the simulation is stopped, <em>1</em> that it is running and <em>2</em> that it is paused.</li>
<li><em>simulationTime</em> topic: messages of type <em>std_msgs::Float32</em> will be published on a regular basis, indicating the current simulation time.</li>
<p>Have a look at the content of the customization script, that can be fully customized for various purposes. Try generating topic messages from the command line, for instance:</p>
<code class="hljs coppelia-terminal">
$ rostopic pub /startSimulation std_msgs/Bool true --once
$ rostopic pub /pauseSimulation std_msgs/Bool true --once
$ rostopic pub /stopSimulation std_msgs/Bool true --once
$ rostopic pub /enableSyncMode std_msgs/Bool true --once
$ rostopic pub /startSimulation std_msgs/Bool true --once
$ rostopic pub /triggerNextStep std_msgs/Bool true --once
$ rostopic pub /triggerNextStep std_msgs/Bool true --once
$ rostopic pub /triggerNextStep std_msgs/Bool true --once
$ rostopic pub /stopSimulation std_msgs/Bool true --once
</code>
<p>In order to display the current simulation time, you could type:</p>
<code class="hljs coppelia-terminal">
$ rostopic echo /simulationTime
</code>
<p>Finally, make sure to have a look at the <a href="remoteApiOverview.htm">remote API functionality</a> in CoppeliaSim: it allows for remote function execution, fast data streaming back and forth, is quite simple to use, leightweight and  cross-platform. The remote API functionality is available for 7 different languages and can be an interesting alternative to ROS in some cases.</p>
<br/>
<br/>
</td></tr>
</table>
</div><br />ROS tutorials << <a href='ROS tutorials.html'>Previous</a> <a href='ROS 2 tutorial.html'>Next</a> >> ROS 2 tutorial</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        