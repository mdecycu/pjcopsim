<!DOCTYPE html><html>
        <head>
        <title>cmsite</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 客製化關閉 -->
        <!--
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        -->
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container">
                <div class="row align-items-center">
                <h1>cmsite</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">cmsite</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='User Manual.html'>User Manual</a><li class='has-children'><a href='User interface.html'>User interface</a><ul class='dropdown'><li><a href='Pages and views.html'>Pages and views</a><li><a href='Positionorientation manipulation.html'>Positionorientation manipulation</a><li><a href='Position dialog.html'>Position dialog</a><li><a href='Orientation dialog.html'>Orientation dialog</a><li><a href='Object movement via the mouse.html'>Object movement via the mouse</a><li><a href='On positions, orientations and transformations.html'>On positions, orientations and transformations</a><li><a href='User settings.html'>User settings</a><li><a href='Shortcuts.html'>Shortcuts</a></li></ul><li class='has-children'><a href='Scenes and models.html'>Scenes and models</a><ul class='dropdown'><li><a href='Scenes.html'>Scenes</a><li><a href='Models.html'>Models</a><li><a href='Model dialog.html'>Model dialog</a></li></ul><li class='has-children'><a href='Environment.html'>Environment</a><ul class='dropdown'><li><a href='Environment dialog.html'>Environment dialog</a><li><a href='Texture dialog.html'>Texture dialog</a></li></ul><li class='has-children'><a href='Entities.html'>Entities</a><ul class='dropdown'><li><a href='Collections.html'>Collections</a><li class='has-children'><a href='Scene objects.html'>Scene objects</a><ul class='dropdown'><li><a href='Object properties.html'>Object properties</a><li><a href='Object common properties.html'>Object common properties</a></li></ul><li><a href='Collidable objects.html'>Collidable objects</a><li><a href='Measurable objects.html'>Measurable objects</a><li><a href='Detectable objects.html'>Detectable objects</a><li><a href='Viewable objects.html'>Viewable objects</a><li><a href='Convex hull.html'>Convex hull</a><li class='has-children'><a href='Layer selection dialog.html'>Layer selection dialog</a><ul class='dropdown'><li><a href='Cameras.html'>Cameras</a><li><a href='Camera properties.html'>Camera properties</a><li><a href='Lights.html'>Lights</a><li><a href='Light properties.html'>Light properties</a><li><a href='Shapes.html'>Shapes</a><li><a href='Shape coordinate frame.html'>Shape coordinate frame</a><li><a href='Primitive shapes.html'>Primitive shapes</a><li><a href='Convex decomposition.html'>Convex decomposition</a><li><a href='Shape properties.html'>Shape properties</a><li><a href='Shape dynamics properties.html'>Shape dynamics properties</a><li><a href='Material properties.html'>Material properties</a><li><a href='Shape geometry dialog.html'>Shape geometry dialog</a><li><a href='Shape edit modes.html'>Shape edit modes</a><li><a href='Triangle edit mode.html'>Triangle edit mode</a><li><a href='Vertex edit mode.html'>Vertex edit mode</a><li><a href='Edge edit mode.html'>Edge edit mode</a><li><a href='Edit mode for compound shapes.html'>Edit mode for compound shapes</a><li><a href='Joints.html'>Joints</a><li><a href='Joint modes.html'>Joint modes</a><li><a href='Joint properties.html'>Joint properties</a><li><a href='Joint dynamics properties.html'>Joint dynamics properties</a><li><a href='Dynamics engines properties related to joints.html'>Dynamics engines properties related to joints</a><li><a href='Dummies.html'>Dummies</a><li><a href='Dummy properties.html'>Dummy properties</a><li><a href='Graphs.html'>Graphs</a><li><a href='Graph properties.html'>Graph properties</a><li><a href='Proximity sensors.html'>Proximity sensors</a><li><a href='Proximity sensor types and mode of operation.html'>Proximity sensor types and mode of operation</a><li><a href='Proximity sensor properties.html'>Proximity sensor properties</a><li><a href='Proximity sensor volume dialog.html'>Proximity sensor volume dialog</a><li><a href='Proximity sensor detection parameter dialog.html'>Proximity sensor detection parameter dialog</a><li><a href='Vision sensors.html'>Vision sensors</a><li><a href='Vision sensor types and mode of operation.html'>Vision sensor types and mode of operation</a><li><a href='Vision sensor properties.html'>Vision sensor properties</a><li><a href='Force sensors.html'>Force sensors</a><li><a href='Force sensor property.html'>Force sensor property</a><li><a href='OC trees.html'>OC trees</a><li><a href='OC tree properties.html'>OC tree properties</a><li><a href='Point clouds.html'>Point clouds</a><li><a href='Point cloud properties.html'>Point cloud properties</a></li></ul><li><a href='Paths.html'>Paths</a></li></ul><li class='has-children'><a href='Functionality.html'>Functionality</a><ul class='dropdown'><li><a href='Geometric calculations.html'>Geometric calculations</a><li><a href='Collision detection.html'>Collision detection</a><li class='has-children'><a href='Distance calculation.html'>Distance calculation</a><ul class='dropdown'><li><a href='Geometric plugin.html'>Geometric plugin</a><li><a href='simGeom API reference.html'>simGeom API reference</a><li><a href='Coppelia geometric routines.html'>Coppelia geometric routines</a><li><a href='API reference-1.html'>API reference-1</a></li></ul><li><a href='simIGL API reference.html'>simIGL API reference</a><li><a href='Kinematics.html'>Kinematics</a><li><a href='Basics on IK groups and IK elements.html'>Basics on IK groups and IK elements</a><li class='has-children'><a href='Solving IK and FK for any type of mechanism.html'>Solving IK and FK for any type of mechanism</a><ul class='dropdown'><li><a href='Kinematics plugin.html'>Kinematics plugin</a><li><a href='simIK API reference.html'>simIK API reference</a><li><a href='Coppelia kinematics routines.html'>Coppelia kinematics routines</a><li><a href='API reference-2.html'>API reference-2</a></li></ul><li><a href='Dynamics.html'>Dynamics</a><li class='has-children'><a href='Designing dynamic simulations.html'>Designing dynamic simulations</a><ul class='dropdown'><li><a href='General dynamics properties.html'>General dynamics properties</a><li><a href='Dynamics engines general properties.html'>Dynamics engines general properties</a></li></ul><li><a href='Data visualizationoutput.html'>Data visualizationoutput</a><li><a href='Web-browser based front-end.html'>Web-browser based front-end</a><li><a href='Data manipulationtransformation.html'>Data manipulationtransformation</a><li class='has-children'><a href='Messaginginterfacesconnectivity.html'>Messaginginterfacesconnectivity</a><ul class='dropdown'><li><a href='Remote API.html'>Remote API</a><li><a href='ZeroMQ remote API.html'>ZeroMQ remote API</a><li><a href='WebSocket remote API.html'>WebSocket remote API</a><li><a href='ROS Interfaces.html'>ROS Interfaces</a><li><a href='ROS Interface.html'>ROS Interface</a><li><a href='simROS API reference.html'>simROS API reference</a><li><a href='ROS 2 Interface.html'>ROS 2 Interface</a><li><a href='simROS2 API reference.html'>simROS2 API reference</a></li></ul><li><a href='simZMQ API reference.html'>simZMQ API reference</a><li><a href='simWS API reference.html'>simWS API reference</a><li><a href='Pathstrajectories.html'>Pathstrajectories</a><li><a href='Path planning.html'>Path planning</a><li><a href='simOMPL API reference.html'>simOMPL API reference</a><li><a href='Synthetic vision.html'>Synthetic vision</a><li><a href='simIM API reference.html'>simIM API reference</a><li><a href='simVision API reference.html'>simVision API reference</a><li><a href='Custom user interfaces.html'>Custom user interfaces</a><li><a href='simUI API reference.html'>simUI API reference</a><li><a href='simUI XML syntax.html'>simUI XML syntax</a><li><a href='simQML API reference.html'>simQML API reference</a><li><a href='Importexport.html'>Importexport</a><li class='has-children'><a href='XML format.html'>XML format</a><ul class='dropdown'><li><a href='URDF format.html'>URDF format</a><li><a href='simURDF API reference.html'>simURDF API reference</a><li><a href='SDF format.html'>SDF format</a><li><a href='simSDF API reference.html'>simSDF API reference</a></li></ul><li><a href='Video exporter.html'>Video exporter</a><li><a href='simAssimp API reference.html'>simAssimp API reference</a><li class='has-children'><a href='simGLTF API reference.html'>simGLTF API reference</a><ul class='dropdown'><li><a href='Commandssetting.html'>Commandssetting</a><li><a href='simLuaCmd API reference.html'>simLuaCmd API reference</a><li><a href='Miscellaneous.html'>Miscellaneous</a><li><a href='simSurfRec API reference.html'>simSurfRec API reference</a><li><a href='simICP API reference.html'>simICP API reference</a><li><a href='simSubprocess API reference.html'>simSubprocess API reference</a></li></li></ul></ul><li class='has-children'><a href='Coding.html'>Coding</a><ul class='dropdown'><li class='has-children'><a href='Scripts.html'>Scripts</a><ul class='dropdown'><li><a href='Embedded scripts.html'>Embedded scripts</a><li><a href='Simulation scripts.html'>Simulation scripts</a><li><a href='The main script.html'>The main script</a><li><a href='Child scripts.html'>Child scripts</a><li><a href='Customization scripts.html'>Customization scripts</a><li><a href='Script dialog.html'>Script dialog</a><li><a href='Script editor.html'>Script editor</a></li></ul><li><a href='Add-ons.html'>Add-ons</a><li><a href='The sandbox script.html'>The sandbox script</a><li><a href='Script execution order.html'>Script execution order</a><li class='has-children'><a href='Threaded and non-threaded script code.html'>Threaded and non-threaded script code</a><ul class='dropdown'><li><a href='Callback functions.html'>Callback functions</a><li><a href='Dynamics callback functions.html'>Dynamics callback functions</a><li><a href='Joint callback functions.html'>Joint callback functions</a><li><a href='Contact callback function.html'>Contact callback function</a><li><a href='Vision callback functions.html'>Vision callback functions</a><li><a href='Trigger callback functions.html'>Trigger callback functions</a><li><a href='User config callback functions.html'>User config callback functions</a></li></ul><li><a href='Lua vs Python scripts.html'>Lua vs Python scripts</a><li><a href='Lua crash course.html'>Lua crash course</a><li><a href='Plugins.html'>Plugins</a><li><a href='The main client application.html'>The main client application</a><li><a href='Accessing scene objects programmatically.html'>Accessing scene objects programmatically</a><li><a href='Explicit and non-explicit calls.html'>Explicit and non-explicit calls</a><li><a href='CoppeliaSim API framework.html'>CoppeliaSim API framework</a><li><a href='Regular API reference.html'>Regular API reference</a><li><a href='Regular API constants.html'>Regular API constants</a><li><a href='Object parameter IDs.html'>Object parameter IDs</a></li></ul><li class='has-children'><a href='Simulation.html'>Simulation</a><ul class='dropdown'><li><a href='Simulation settings dialog.html'>Simulation settings dialog</a></li></ul><li class='has-children'><a href='Tutorials.html'>Tutorials</a><ul class='dropdown'><li><a href='BubbleRob tutorial.html'>BubbleRob tutorial</a><li><a href='Building a clean model tutorial.html'>Building a clean model tutorial</a><li><a href='Line following BubbleRob tutorial.html'>Line following BubbleRob tutorial</a><li><a href='Inverse kinematics tutorial.html'>Inverse kinematics tutorial</a><li><a href='External controller tutorial.html'>External controller tutorial</a><li><a href='Plugin tutorial.html'>Plugin tutorial</a><li><a href='Robot language interpreter integration tutorial.html'>Robot language interpreter integration tutorial</a><li><a href='ROS tutorials.html'>ROS tutorials</a><li><a href='ROS tutorial.html'>ROS tutorial</a><li><a href='ROS 2 tutorial.html'>ROS 2 tutorial</a><li><a href='Compiling CoppeliaSim.html'>Compiling CoppeliaSim</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">Line following BubbleRob tutorial << <a href='Line following BubbleRob tutorial.html'>Previous</a> <a href='External controller tutorial.html'>Next</a> >> External controller tutorial<br /><h1>Inverse kinematics tutorial</h1><div align="center">
<table class="allEncompassingTable">
<tr>
<td>
<p><a href="../index.html" target="_top"><img src="./../images/homeImg.png"/></a></p>
<h4>Inverse kinematics tutorial</h4>
<p>This tutorial explains how to use CoppeliaSim's <a href="kinematics.htm">kinematics functionality</a>, while building a 7 DoF redundant manipulator. But before that, make sure  to have a look at the various example scenes related to IK and FK in folder <em>scenes/kinematics</em>. </p>
<p>This tutorial is segmented into 3 parts:</p>
<li><a href="#model">Building</a> the simple simulation model of a redundant manipulator</li>
<li><a href="#setup">Setting up</a> an inverse kinematics task</li>
<li><a href="#run">Testing</a> the inverse kinematics</li>
<br/>
<br/>
<h4>
<a name="model"></a>Simple simulation model
</h4>
<p>For this tutorial, we will build a non-dynamic manipulator, that just uses inverse kinematics without using any physics engine functionality. The CoppeliaSim CAD data related to this tutorial (<em>redundantManipulator.stl</em>) is located in CoppeliaSim's installation folder <em>cadFiles</em>. A CoppeliaSim scene related to this tutorial can be found in <em>scenes/tutorials/InverseKinematics</em>. Click [Menu bar --&gt; File --&gt; Import --&gt; Mesh...] then select the file to import. Also refer to the section on how to <a href="importExport.htm">import/export shapes</a>. A dialog pops open with various import options. Click <em>Import</em>. A single <a href="shapes.htm">simple shape</a> was imported and is located in the middle of the scene. The shape also appears in the <a href="userInterface.htm#SceneHierarchy">scene hierarchy</a> on the left hand side of the main window. Depending on how the original CAD data was exported, the imported CAD data could be at a different scale, different location, or even subdivided into several shapes. Following figure shows the imported shape:<br/>
</p>
<p align="center"><img src="./../images/ikTut1.jpg"/></p>
<br/>
<p>As you can see, the import operation has left us with a single shape, where we expected several shapes. This means that we will have to divide the manipulator object ourselves: select the object (just click on it in the scene or the scene hierarchy), then click [Menu bar --&gt; Edit --&gt; Grouping/Merging --&gt; Divide selected shapes]. Following is what you should have:<br/>
</p>
<p align="center"><img src="./../images/ikTut2.jpg"/></p>
<br/>
<p>The original shape was divided into several sub-shapes (see also the scene hierarchy). The shape division algorithm operates by grouping all triangles that are linked by common edges. Depending on how the original mesh was created or exported, such a division procedure cannot be performed. In that case you will have to manually extract shapes in the <a href="triangleEditMode.htm">triangle edit mode</a> or in an external editor.<br/>
</p>
<p>Next, we will change colors of the various objects so as to have a nice visual appearance. First double-click a shape icon in the scene hierarchy. The <a href="shapeProperties.htm">shape properties</a> dialog opens. While a shape is selected, click on <strong>Adjust  color</strong> in the dialog: this will allow you to adjust the various color components of the  selected shape. For now, just adjust the ambient/diffuse color component of your shapes. To transfer the color of one shape to another shape, select both shapes and make sure the last selected shape (indicated with a white bounding box) is the one you want to take the color from, then simply click the <strong>Apply to selection</strong> button in the <strong>Colors</strong> section of the shape dialog. Once you finished coloring, you might have following situation:<br/>
</p>
<p align="center"><img src="./../images/ikTut3.jpg"/></p>
<br/>
<p>In next step, we will add the 7 <a href="joints.htm">joints</a> of the manipulator. One way of doing this is to add the joints into the scene, then specify their appropriate position and orientation (through the <a href="positionDialog.htm">position dialog</a> and the <a href="orientationDialog.htm">orientation dialog</a>). This is however not possible, when you don't know the exact joint linear/angular positions as in our case, and so we will have to <em>extract</em> them from the shapes that we have:<br/>
</p>
<p>Select all imported shapes and click [Menu bar --&gt; Edit --&gt; Reorient bounding box --&gt; with reference frame of world]. This operation guarantees that our <a href="shapeReferenceFrames.htm">bounding boxes</a> are aligned with the absolute reference frame, and given the current manipulator configuration, represents the smallest bounding boxes. Click [Menu bar --&gt; Add --&gt; Joint --&gt; Revolute] to insert a revolute joint into the scene. The default position is at (0;0;0) and its default orientation is vertical, and so the joint is hidden by the manipulator's base cylinder. While the joint is still selected, ctrl-select the base cylinder, then open the <a href="positionDialog.htm">position dialog</a> on the <strong>position</strong> tab and click the <strong>Apply to selection</strong>. This just positioned the joint at the exact same coordinates as the base cylinder (this operation however only slightly adjusted the joint's vertical position since it was already almost in position). Now repeat the procedure for all other joints in the manipulator (remember there should be a total of 7). All joints are in position now, however, some of them have the wrong orientation. Select all joints that should be aligned with the world's Y-axis, then enter (90,0,0) for the <strong>Alpha</strong>, <strong>Beta</strong> and <strong>Gamma</strong> items in the <a href="orientationDialog.htm">orientation dialog</a>, on the <strong>orientation</strong> tab,  then click the <strong>Apply to selection</strong> button. Next, select the joint that should be aligned with the world's X-axis, then enter (0,90,0) for  <strong>Alpha</strong>, <strong>Beta</strong> and <strong>Gamma</strong>. All joints have the right position and orientation now. <br/>
</p>
<p>You can now adjust the joint sizes (check the <strong>Length</strong> and <strong>Diameter</strong> items) in the <a href="jointProperties.htm">joint properties</a> dialog (that you can open by double-clicking a joint icon in the scene hierarchy). Make sure that all joints are clearly visible. This is what you should have:<br/>
</p>
<p align="center"><img src="./../images/ikTut5.jpg"/></p>
<br/>
<p>The next step in this tutorial is to group shapes that belong to the same rigid entity. Select the 5 shapes that are part of link 1 (the base cylinder being link 0), then click [Menu bar --&gt; Edit --&gt; Grouping/Merging --&gt; Group selected shapes]. Once the shapes are grouped in a compound shape, you could re-align its bounding box with the world, but this step is not required (and has only a visual effect). Repeat the same procedure with all shapes that logically belong together. In this tutorial we will not actuate the gripper's fingers, and so simply rigidly group them with the last link. When all shapes that are meant to be grouped share the same visual attributes, try merging them together instead: [Menu bar --&gt; Edit --&gt; Grouping/Merging --&gt; Merge selected shapes].<br/>
</p>
<p>At this point you can rename all objects in the scene in following way, when going from base to tip: <em>redundantRobot</em> -  <em>redundantRob_joint1</em>  - <em>redundantRob_link1</em> - <em>redundantRob_joint2</em>, etc. Just double-click an object's alias in the scene hierarchy to edit it.<br/>
</p>
<p>Now we can build the kinematic chain, going from tip to base: select object <em>redundantRob_link7</em>, then ctrl-select object <em>redundantRob_joint7</em> and click [Menu bar --&gt; Edit --&gt; Make last selected object parent]. Alternatively you can drag an object onto another one in the scene hierarchy to achieve a similar operation. Next do the same for object <em>redundantRob_joint7</em> and object <em>redundantRob_link6</em>. Continue in a same way until the whole kinematic chain of the manipulator was built. This is what you should have (notice the scene hierarchy structure):<br/>
</p>
<p align="center"><img src="./../images/ikTut6.jpg"/></p>
<br/>
<p>Select all joints, then in the joint dialog, select <strong>kinematic mode</strong>, then click <strong>Apply to selection</strong>. Keep the joints selected, then open the <a href="commonPropertiesDialog.htm">object common properties</a> and in the<strong> Visibility layers</strong> section, disable layer 2 and enable layer 10, then click the related <strong>Apply to selection</strong> button. This just sent all joints to the visibility layer 10, effectively making them invisible. Have a look at the <a href="layerSelectionDialog.htm">layer selection dialog</a> if you wish to temporarily enable/disable some layers.</p>
<p>In CoppeliaSim, an IK task requires specifying at least following elements:</p>
<li>a kinematic chain described with a <em>tip</em> dummy and a <em>base</em> object. </li>
<li>a <em>target</em> dummy that the <em>tip</em> dummy will be constrained to follow. </li>
<p>We already have the base object (object <em>redundantRobot</em>). Let's add a <a href="dummies.htm">dummy object</a>, rename it to <em>redundantRob_tip</em> and set its position to (0.324,0,0.62) using the coordinate and transformation dialog. Next, attach the dummy to <em>redundantRob_link7</em> (select <em>redundantRob_tip</em>, then <em>redundantRob_link7</em>, then [Menu bar --&gt; Edit --&gt; Make last selected object parent]. The <em>tip</em> dummy is ready!<br/>
</p>
<p>Now let's prepare the <em>target</em> dummy: copy and paste <em>redundantRob_tip</em> and rename the copy to <em>redundantRob_target</em>. The <em>target</em> dummy is ready.</p>
<p>Now we will  add a way to easily manipulate the robot, without having to worry about breaking it by shifting the wrong objects around. We will therefore define it as a <a href="models.htm">model</a>. First, move <em>redundantRob_tip</em> and <em>redundantRob_target</em> to layer 11 to make both dummies invisible. Then shift-select all visible objects in the scene view, ctrl-click the object <em>redundantRobot</em> in the scene hierarchy to remove it from the selection, then open the <a href="commonPropertiesDialog.htm">object common properties</a> dialog. Check the <strong>Select base of model instead</strong> item, then the related <strong>Apply to selection</strong> button. Clear the selection with &lt;ESC&gt;, then select <em>redundantRobot</em>. In the same dialog, check the <strong>Object is model base</strong> item, then close the dialogs. Notice how a stippled bounding box now encompasses the whole manipulator:<br/>
</p>
<p align="center"><img src="./../images/ikTut9.jpg"/></p>
<br/>
<p>Click any object on the manipulator and notice how the base object <em>redundantRobot</em> always gets selected instead.<br/>
</p>
<p>Next, we add a <em>manipulation sphere</em> that we will use to manipulate the robot's gripper position/orientation. Click [Menu bar --&gt; Add --&gt; Primitive shape --&gt; Sphere] to open the <a href="primitiveShapes.htm">primitive shape dialog</a>, indicate 0.05 for the <strong>X-Size</strong>, <strong>Y-Size</strong> and <strong>Z-Size</strong>, then uncheck the <strong>Create dynamic and respondable shape</strong> item and click <strong>OK</strong>. Adjust the newly added sphere's position to be the same as <em>redundantRob_target</em> (using the coordinate and transformation dialog). The sphere now appears at the tip of the manipulator. Rename the sphere to <em>redundantRob_manipSphere</em>, then make it parent of <em>redundantRob_target</em>. Make <em> redundantRobot</em> parent of <em>rendundantRob_manipSphere</em>: the target dummy and the manipulation sphere are now also part of the robot model. Collapse the <em>redundantRobot</em> tree in the scene hierarchy. The redundant manipulator model is ready!</p>
<br/>
<br/>
<h4>
<a name="setup"></a>Setting up the inverse kinematics task
</h4>
<p>Inverse kinematics is entirely set up by having a script calling appropriate API commands: the idea is to build an equivalent kinematic model via the  functions provided by the <a href="kinematicsPlugin.htm">kinematics plugin</a>. The approach uses the concept and terminology of <a href="basicsOnIkGroupsAndIkElements.htm">IK groups and IK elements</a>.</p>
<p>Select object <em>redundantRobot</em>, then [Menu bar --&gt; Add --&gt; Associated child script --&gt; Non-threaded] to attach a <a href="childScripts.htm">child script</a> to that object. Double-click the script icon that appeared next to the object alias, and replace the script content with following code:</p>
<code class="hljs language-lua coppelia-coppeliasim-script">
function sysCall_init()
    -- Build a kinematic chain and 2 IK groups (undamped and damped) inside of the IK plugin environment,
    -- based on the kinematics of the robot in the scene:
    -- There is a simple way, and a more elaborate way (but which gives you more options/flexibility):

    -- Simple way:
    local simBase=sim.getObject('.')
    local simTip=sim.getObject('./redundantRob_tip')
    local simTarget=sim.getObject('./redundantRob_target')
    -- create an IK environment:
    ikEnv=simIK.createEnvironment()
    -- create an IK group: 
    ikGroup_undamped=simIK.createIkGroup(ikEnv)
    -- set its resolution method to undamped: 
    simIK.setIkGroupCalculation(ikEnv,ikGroup_undamped,simIK.method_pseudo_inverse,0,6)
    -- create an IK element based on the scene content: 
    simIK.addIkElementFromScene(ikEnv,ikGroup_undamped,simBase,simTip,simTarget,simIK.constraint_pose)
    -- create another IK group: 
    ikGroup_damped=simIK.createIkGroup(ikEnv)
    -- set its resolution method to damped: 
    simIK.setIkGroupCalculation(ikEnv,ikGroup_damped,simIK.method_damped_least_squares,1,99)
    -- create an IK element based on the scene content: 
    simIK.addIkElementFromScene(ikEnv,ikGroup_damped,simBase,simTip,simTarget,simIK.constraint_pose) 
    
    -- Elaborate way:
    --[[
    simBase=sim.getObject('.')
    simTip=sim.getObject('./redundantRob_tip')
    simTarget=sim.getObject('./redundantRob_target')
    simJoints={}
    for i=1,7,1 do
        simJoints[i]=sim.getObject('./redundantRob_joint'..i)
    end
    ikJoints={}
    -- create an IK environment:
    ikEnv=simIK.createEnvironment()
    -- create a dummy in the IK environment: 
    ikBase=simIK.createDummy(ikEnv)
    -- set that dummy into the same pose as its CoppeliaSim counterpart: 
    simIK.setObjectMatrix(ikEnv,ikBase,-1,sim.getObjectMatrix(simBase,-1)) 
    local parent=ikBase
    for i=1,#simJoints,1 do -- loop through all joints
        -- create a joint in the IK environment:
        ikJoints[i]=simIK.createJoint(ikEnv,simIK.jointtype_revolute)
        -- set it into IK mode: 
        simIK.setJointMode(ikEnv,ikJoints[i],simIK.jointmode_ik)
        -- set the same joint limits as its CoppeliaSim counterpart joint: 
        local cyclic,interv=sim.getJointInterval(simJoints[i])
        simIK.setJointInterval(ikEnv,ikJoints[i],cyclic,interv)
        -- set the same joint lin./ang. position as its CoppeliaSim counterpart joint: 
        simIK.setJointPosition(ikEnv,ikJoints[i],sim.getJointPosition(simJoints[i]))
        -- set the same object pose as its CoppeliaSim counterpart joint: 
        simIK.setObjectMatrix(ikEnv,ikJoints[i],-1,sim.getObjectMatrix(simJoints[i],-1))
        -- set its corresponding parent: 
        simIK.setObjectParent(ikEnv,ikJoints[i],parent,true) 
        parent=ikJoints[i]
    end
    -- create the tip dummy in the IK environment:
    ikTip=simIK.createDummy(ikEnv)
    -- set that dummy into the same pose as its CoppeliaSim counterpart: 
    simIK.setObjectMatrix(ikEnv,ikTip,-1,sim.getObjectMatrix(simTip,-1))
    -- attach it to the kinematic chain: 
    simIK.setObjectParent(ikEnv,ikTip,parent,true)
    -- create the target dummy in the IK environment: 
    ikTarget=simIK.createDummy(ikEnv)
    -- set that dummy into the same pose as its CoppeliaSim counterpart: 
    simIK.setObjectMatrix(ikEnv,ikTarget,-1,sim.getObjectMatrix(simTarget,-1))
    -- link the two dummies: 
    simIK.setLinkedDummy(ikEnv,ikTip,ikTarget)
    -- create an IK group: 
    ikGroup_undamped=simIK.createIkGroup(ikEnv)
    -- set its resolution method to undamped: 
    simIK.setIkGroupCalculation(ikEnv,ikGroup_undamped,simIK.method_pseudo_inverse,0,6)
    -- make sure the robot doesn't shake if the target position/orientation wasn't reached: 
    simIK.setIkGroupFlags(ikEnv,ikGroup_undamped,1+2+4+8)
    -- add an IK element to that IK group: 
    local ikElementHandle=simIK.addIkElement(ikEnv,ikGroup_undamped,ikTip)
    -- specify the base of that IK element: 
    simIK.setIkElementBase(ikEnv,ikGroup_undamped,ikElementHandle,ikBase)
    -- specify the constraints of that IK element: 
    simIK.setIkElementConstraints(ikEnv,ikGroup_undamped,ikElementHandle,simIK.constraint_pose)
    -- create another IK group: 
    ikGroup_damped=simIK.createIkGroup(ikEnv)
    -- set its resolution method to damped: 
    simIK.setIkGroupCalculation(ikEnv,ikGroup_damped,simIK.method_damped_least_squares,1,99)
    -- add an IK element to that IK group: 
    local ikElementHandle=simIK.addIkElement(ikEnv,ikGroup_damped,ikTip)
    -- specify the base of that IK element: 
    simIK.setIkElementBase(ikEnv,ikGroup_damped,ikElementHandle,ikBase)
    -- specify the constraints of that IK element: 
    simIK.setIkElementConstraints(ikEnv,ikGroup_damped,ikElementHandle,simIK.constraint_pose) 
    --]]
end

function sysCall_actuation()
    -- There is a simple way, and a more elaborate way (but which gives you more options/flexibility):
    
    -- Simple way:
    -- try to solve with the undamped method:
    if simIK.applyIkEnvironmentToScene(ikEnv,ikGroup_undamped,true)==simIK.result_fail then 
        -- the position/orientation could not be reached.
        -- try to solve with the damped method:
        simIK.applyIkEnvironmentToScene(ikEnv,ikGroup_damped)
        -- We display a IK failure report message:
        sim.addLog(sim.verbosity_scriptwarnings,"IK solver failed.") 
    end
    
    -- Elaborate way:
    --[[
    -- reflect the pose of the target dummy to its counterpart in the IK environment:
    simIK.setObjectMatrix(ikEnv,ikTarget,ikBase,sim.getObjectMatrix(simTarget,simBase)) 
    -- try to solve with the undamped method:
    if simIK.handleIkGroup(ikEnv,ikGroup_undamped)==simIK.result_fail then 
        -- the position/orientation could not be reached.
        -- try to solve with the damped method:
        simIK.handleIkGroup(ikEnv,ikGroup_damped)
        -- We display a IK failure report message: 
        sim.addLog(sim.verbosity_scriptwarnings,"IK solver failed.") 
    end
    -- apply the joint values computed in the IK environment to their CoppeliaSim joint counterparts:
    for i=1,#simJoints,1 do
        sim.setJointPosition(simJoints[i],simIK.getJointPosition(ikEnv,ikJoints[i])) 
    end
    --]]
end 

function sysCall_cleanup()
    -- erase the IK environment: 
    simIK.eraseEnvironment(ikEnv) 
end </code>
<p>Above script creates an equivalent kinematic model from the CoppeliaSim model, then in each simulation step, reads the position/orientation of the CoppeliaSim target, applies it to the target of the equivalent kinematic model, runs the IK solver, and finally reads the joint angles of the equivalent kinematic model, and applies them to the joints of the CoppeliaSim model. To handle singular configurations and situations where the target is out of reach, we first try with a non-damped solver, and if it fails, we revert to a damped solver (with a damped solver, when damping is large, resolution becomes more stable but convergence slower).</p>
<br/>
<h4><a name="run"></a>Running the simulation
</h4>
<p>Our inverse kinematics task is ready! Let's test it. Run the simulation, then select the green manipulation sphere. Next,  select the <a href="positionDialog.htm">object translation</a> toolbar button:<br/>
</p>
<p align="center"><img src="./../images/objectShiftButton.jpg"/></p>
<br/>
<p>Now drag the object with the mouse: the manipulator should follow. Also try the <a href="orientationDialog.htm">object rotation</a> toolbar button:<br/>
</p>
<p align="center"><img src="./../images/objectRotateButton.jpg"/></p>
<br/>
<p>Try also holding down the ctr- or shift-keys during manipulation. Switch back to the object translation toolbar button, and try to drag the object as far as possible, and notice how the inverse kinematics task is quite robust, thanks to the damped component. Stop the simulation, then disable the damped IK group and try again. Try also to disable individual constraints in the corresponding IK element and notice how the manipulator behaves during simulation.<br/>
</p>
<p>Run the simulation, and copy-paste a few times the manipulator and shift/rotate the copies around, also changing their configurations by dragging their manipulation spheres. Notice how every manipulator instance is fully functional regarding IK.<br/>
</p>
</td></tr>
</table>
</div><br />Line following BubbleRob tutorial << <a href='Line following BubbleRob tutorial.html'>Previous</a> <a href='External controller tutorial.html'>Next</a> >> External controller tutorial</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        