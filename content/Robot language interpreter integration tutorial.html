<!DOCTYPE html><html>
        <head>
        <title>cmsite</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 客製化關閉 -->
        <!--
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        -->
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container">
                <div class="row align-items-center">
                <h1>cmsite</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">cmsite</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='CoppeliaSim User Manual.html'>CoppeliaSim User Manual</a><li class='has-children'><a href='User interface.html'>User interface</a><ul class='dropdown'><li><a href='Pages and views.html'>Pages and views</a><li><a href='Positionorientation manipulation.html'>Positionorientation manipulation</a><li><a href='Position dialog.html'>Position dialog</a><li><a href='Orientation dialog.html'>Orientation dialog</a><li><a href='Object movement via the mouse.html'>Object movement via the mouse</a><li><a href='On positions, orientations and transformations.html'>On positions, orientations and transformations</a><li><a href='User settings.html'>User settings</a><li><a href='Shortcuts.html'>Shortcuts</a></li></ul><li class='has-children'><a href='Scenes and models.html'>Scenes and models</a><ul class='dropdown'><li><a href='Scenes.html'>Scenes</a><li><a href='Models.html'>Models</a><li><a href='Model dialog.html'>Model dialog</a></li></ul><li class='has-children'><a href='Environment.html'>Environment</a><ul class='dropdown'><li><a href='Environment dialog.html'>Environment dialog</a><li><a href='Texture dialog.html'>Texture dialog</a></li></ul><li class='has-children'><a href='Entities.html'>Entities</a><ul class='dropdown'><li><a href='Collections.html'>Collections</a><li class='has-children'><a href='Scene objects.html'>Scene objects</a><ul class='dropdown'><li><a href='Object properties.html'>Object properties</a><li><a href='Object common properties.html'>Object common properties</a></li></ul><li><a href='Collidable objects.html'>Collidable objects</a><li><a href='Measurable objects.html'>Measurable objects</a><li><a href='Detectable objects.html'>Detectable objects</a><li><a href='Viewable objects.html'>Viewable objects</a><li><a href='Convex hull.html'>Convex hull</a><li class='has-children'><a href='Layer selection dialog.html'>Layer selection dialog</a><ul class='dropdown'><li><a href='Cameras.html'>Cameras</a><li><a href='Camera properties.html'>Camera properties</a><li><a href='Lights.html'>Lights</a><li><a href='Light properties.html'>Light properties</a><li><a href='Shapes.html'>Shapes</a><li><a href='Shape coordinate frame.html'>Shape coordinate frame</a><li><a href='Primitive shapes.html'>Primitive shapes</a><li><a href='Convex decomposition.html'>Convex decomposition</a><li><a href='Shape properties.html'>Shape properties</a><li><a href='Shape dynamics properties.html'>Shape dynamics properties</a><li><a href='Material properties.html'>Material properties</a><li><a href='Shape geometry dialog.html'>Shape geometry dialog</a><li><a href='Shape edit modes.html'>Shape edit modes</a><li><a href='Triangle edit mode.html'>Triangle edit mode</a><li><a href='Vertex edit mode.html'>Vertex edit mode</a><li><a href='Edge edit mode.html'>Edge edit mode</a><li><a href='Edit mode for compound shapes.html'>Edit mode for compound shapes</a><li><a href='Joints.html'>Joints</a><li><a href='Joint modes.html'>Joint modes</a><li><a href='Joint properties.html'>Joint properties</a><li><a href='Joint dynamics properties.html'>Joint dynamics properties</a><li><a href='Dynamics engines properties related to joints.html'>Dynamics engines properties related to joints</a><li><a href='Dummies.html'>Dummies</a><li><a href='Dummy properties.html'>Dummy properties</a><li><a href='Graphs.html'>Graphs</a><li><a href='Graph properties.html'>Graph properties</a><li><a href='Proximity sensors.html'>Proximity sensors</a><li><a href='Proximity sensor types and mode of operation.html'>Proximity sensor types and mode of operation</a><li><a href='Proximity sensor properties.html'>Proximity sensor properties</a><li><a href='Proximity sensor volume dialog.html'>Proximity sensor volume dialog</a><li><a href='Proximity sensor detection parameter dialog.html'>Proximity sensor detection parameter dialog</a><li><a href='Vision sensors.html'>Vision sensors</a><li><a href='Vision sensor types and mode of operation.html'>Vision sensor types and mode of operation</a><li><a href='Vision sensor properties.html'>Vision sensor properties</a><li><a href='Force sensors.html'>Force sensors</a><li><a href='Force sensor property.html'>Force sensor property</a><li><a href='OC trees.html'>OC trees</a><li><a href='OC tree properties.html'>OC tree properties</a><li><a href='Point clouds.html'>Point clouds</a><li><a href='Point cloud properties.html'>Point cloud properties</a></li></ul><li><a href='Paths.html'>Paths</a></li></ul><li class='has-children'><a href='Functionality.html'>Functionality</a><ul class='dropdown'><li><a href='Geometric calculations.html'>Geometric calculations</a><li><a href='Collision detection.html'>Collision detection</a><li class='has-children'><a href='Distance calculation.html'>Distance calculation</a><ul class='dropdown'><li><a href='Geometric plugin.html'>Geometric plugin</a><li><a href='simGeom API reference.html'>simGeom API reference</a><li><a href='Coppelia geometric routines.html'>Coppelia geometric routines</a><li><a href='API reference-1.html'>API reference-1</a></li></ul><li><a href='simIGL API reference.html'>simIGL API reference</a><li><a href='Kinematics.html'>Kinematics</a><li><a href='Basics on IK groups and IK elements.html'>Basics on IK groups and IK elements</a><li class='has-children'><a href='Solving IK and FK for any type of mechanism.html'>Solving IK and FK for any type of mechanism</a><ul class='dropdown'><li><a href='Kinematics plugin.html'>Kinematics plugin</a><li><a href='simIK API reference.html'>simIK API reference</a><li><a href='Coppelia kinematics routines.html'>Coppelia kinematics routines</a><li><a href='API reference-2.html'>API reference-2</a></li></ul><li><a href='Dynamics.html'>Dynamics</a><li class='has-children'><a href='Designing dynamic simulations.html'>Designing dynamic simulations</a><ul class='dropdown'><li><a href='General dynamics properties.html'>General dynamics properties</a><li><a href='Dynamics engines general properties.html'>Dynamics engines general properties</a></li></ul><li><a href='Data visualizationoutput.html'>Data visualizationoutput</a><li><a href='Web-browser based front-end.html'>Web-browser based front-end</a></li></ul><li class='has-children'><a href='Data manipulationtransformation.html'>Data manipulationtransformation</a><ul class='dropdown'><li class='has-children'><a href='Messaginginterfacesconnectivity.html'>Messaginginterfacesconnectivity</a><ul class='dropdown'><li><a href='Remote API.html'>Remote API</a><li><a href='ZeroMQ remote API.html'>ZeroMQ remote API</a><li><a href='WebSocket remote API.html'>WebSocket remote API</a><li><a href='ROS Interfaces.html'>ROS Interfaces</a><li><a href='ROS Interface.html'>ROS Interface</a><li><a href='simROS API reference.html'>simROS API reference</a><li><a href='ROS 2 Interface.html'>ROS 2 Interface</a><li><a href='simROS2 API reference.html'>simROS2 API reference</a></li></ul><li><a href='simZMQ API reference.html'>simZMQ API reference</a><li><a href='simWS API reference.html'>simWS API reference</a></li></ul><li class='has-children'><a href='Pathstrajectories.html'>Pathstrajectories</a><ul class='dropdown'><li><a href='Path planning.html'>Path planning</a><li><a href='simOMPL API reference.html'>simOMPL API reference</a><li><a href='Synthetic vision.html'>Synthetic vision</a><li><a href='simIM API reference.html'>simIM API reference</a><li><a href='simVision API reference.html'>simVision API reference</a><li><a href='Custom user interfaces.html'>Custom user interfaces</a><li><a href='simUI API reference.html'>simUI API reference</a><li><a href='simUI XML syntax.html'>simUI XML syntax</a><li><a href='simQML API reference.html'>simQML API reference</a><li><a href='Importexport.html'>Importexport</a><li class='has-children'><a href='XML format.html'>XML format</a><ul class='dropdown'><li><a href='URDF format.html'>URDF format</a><li><a href='simURDF API reference.html'>simURDF API reference</a><li><a href='SDF format.html'>SDF format</a><li><a href='simSDF API reference.html'>simSDF API reference</a></li></ul><li><a href='Video exporter.html'>Video exporter</a><li><a href='simAssimp API reference.html'>simAssimp API reference</a><li class='has-children'><a href='simGLTF API reference.html'>simGLTF API reference</a><ul class='dropdown'><li><a href='Commandssetting.html'>Commandssetting</a><li><a href='simLuaCmd API reference.html'>simLuaCmd API reference</a><li><a href='Miscellaneous.html'>Miscellaneous</a><li><a href='simSurfRec API reference.html'>simSurfRec API reference</a><li><a href='simICP API reference.html'>simICP API reference</a><li><a href='simSubprocess API reference.html'>simSubprocess API reference</a></li></li></ul></ul><li class='has-children'><a href='Writing code in and around CoppeliaSim.html'>Writing code in and around CoppeliaSim</a><ul class='dropdown'><li class='has-children'><a href='Scripts.html'>Scripts</a><ul class='dropdown'><li><a href='Embedded scripts.html'>Embedded scripts</a><li><a href='Simulation scripts.html'>Simulation scripts</a><li><a href='The main script.html'>The main script</a><li><a href='Child scripts.html'>Child scripts</a><li><a href='Customization scripts.html'>Customization scripts</a><li><a href='Script dialog.html'>Script dialog</a><li><a href='Script editor.html'>Script editor</a></li></ul><li><a href='Add-ons.html'>Add-ons</a><li><a href='The sandbox script.html'>The sandbox script</a><li><a href='Script execution order.html'>Script execution order</a><li class='has-children'><a href='Threaded and non-threaded script code.html'>Threaded and non-threaded script code</a><ul class='dropdown'><li><a href='Callback functions.html'>Callback functions</a><li><a href='Dynamics callback functions.html'>Dynamics callback functions</a><li><a href='Joint callback functions.html'>Joint callback functions</a><li><a href='Contact callback function.html'>Contact callback function</a><li><a href='Vision callback functions.html'>Vision callback functions</a><li><a href='Trigger callback functions.html'>Trigger callback functions</a><li><a href='User config callback functions.html'>User config callback functions</a></li></ul><li><a href='Lua vs Python scripts.html'>Lua vs Python scripts</a><li><a href='Lua crash course.html'>Lua crash course</a><li><a href='Plugins.html'>Plugins</a><li><a href='The main client application.html'>The main client application</a><li><a href='Accessing scene objects programmatically.html'>Accessing scene objects programmatically</a><li><a href='Explicit and non-explicit calls.html'>Explicit and non-explicit calls</a><li><a href='CoppeliaSim API framework.html'>CoppeliaSim API framework</a><li><a href='Regular API reference.html'>Regular API reference</a><li><a href='Regular API constants.html'>Regular API constants</a><li><a href='Object parameter IDs.html'>Object parameter IDs</a></li></ul><li class='has-children'><a href='Simulation.html'>Simulation</a><ul class='dropdown'><li><a href='Simulation settings dialog.html'>Simulation settings dialog</a></li></ul><li class='has-children'><a href='Tutorials.html'>Tutorials</a><ul class='dropdown'><li><a href='BubbleRob tutorial.html'>BubbleRob tutorial</a><li><a href='Building a clean model tutorial.html'>Building a clean model tutorial</a><li><a href='Line following BubbleRob tutorial.html'>Line following BubbleRob tutorial</a><li><a href='Inverse kinematics tutorial.html'>Inverse kinematics tutorial</a><li><a href='External controller tutorial.html'>External controller tutorial</a><li><a href='Plugin tutorial.html'>Plugin tutorial</a><li><a href='Robot language interpreter integration tutorial.html'>Robot language interpreter integration tutorial</a><li><a href='ROS tutorials.html'>ROS tutorials</a><li><a href='ROS tutorial.html'>ROS tutorial</a><li><a href='ROS 2 tutorial.html'>ROS 2 tutorial</a><li><a href='Compiling CoppeliaSim.html'>Compiling CoppeliaSim</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">Plugin tutorial << <a href='Plugin tutorial.html'>Previous</a> <a href='ROS tutorials.html'>Next</a> >> ROS tutorials<br /><h1>Robot language interpreter integration tutorial</h1><div align="center">
<table class="allEncompassingTable">
<tr>
<td>
<p><a href="../index.html" target="_top"><img src="images/homeImg.png"/></a></p>
<h4>Robot language interpreter integration tutorial</h4>
<p>This tutorial will try to explain how to integrate or embed a robot language interpreter into CoppeliaSim. The procedure is very similar in case you want to integrate an emulator (e.g. a specific microcontroller emulator) into CoppeliaSim. Extending CoppeliaSim's functionality requires most of the time the development of a <a href="plugins.htm">plugin</a>. Make sure you have read the <a href="pluginTutorial.htm">tutorial on plugins</a> , and the <a href="externalControllerTutorial.htm">tutorial on external controllers</a> before proceeding with this tutorial.<br/>
</p>
<p>The CoppeliaSim <a href="scenes.htm">scene</a> file related to this tutorial is located in CoppeliaSim's installation folder  <em>scenes\robotLanguageControl.ttt</em>. You can find the  plugin project files <a href="https://github.com/CoppeliaRobotics/simExtMTB" target="_blank">here</a>, and the server application project files <a href="https://github.com/CoppeliaRobotics/mtbServer" target="_blank">here</a>.</p>
<p>First, let's start by loading the related scene file <em>scenes\robotLanguageControl.ttt</em>:<br/>
</p>
<p align="center"><img src="images/robLangTut1.jpg"/></p>
<br/>
<p>The <em>MTB</em> robot is an imaginary robot (<em>MTB</em> stands for <em>Machine Type B</em>), that will be controlled with an imaginary robot language.</p>
<p>As previously stated, the used robot language is imaginary and very very simple. Following commands are supported (one command per line, input is case-sensitive):</p>
<pre class="lightGreyBox">
"<strong>REM</strong>" starts a comment line
"<strong>SETLINVEL</strong> v": sets the prismatic joint velocity for next movements (v is in m/s)
"<strong>SETROTVEL</strong> v": sets the revolute joint velocity for next movements (v is in degrees/s)
"<strong>MOVE</strong> p1 p2 p3 p4": moves to joint positions (p1;p2;p3;p4) (in degrees except for p3 in meters)
"<strong>WAIT</strong> x": waits x milliseconds
"<strong>SETBIT</strong> y": sets the bit at position y (1-32) in the robot output port
"<strong>CLEARBIT</strong> y": clears the bit at position y (1-32) in the robot output port
"<strong>IFBITGOTO</strong> y label": if bit at position y (1-32) in the robot input port is set, jump to "label"
"<strong>IFNBITGOTO</strong> y label": if bit at position y (1-32) in the robot input port is not set, jump to "label"
"<strong>GOTO</strong> label": jumps to "label"</pre>
<p>Any word different from "<strong>REM</strong>", "<strong>SETLINVEL</strong>", "<strong>SETROTVEL</strong>", "<strong>MOVE</strong>", "<strong>WAIT</strong>", "<strong>SETBIT</strong>", "<strong>CLEARBIT</strong>", "<strong>IFBITGOTO</strong>", "<strong>IFNBITGOTO</strong>" and "<strong>GOTO</strong>" is considered to be a label. Now run the simulation. If the related plugin was not found, following message displays (the display of the message is handled in the <a href="childScripts.htm">child scripts</a> attached to <a href="objects.htm">objects</a> <em>MTB_Robot</em> and <em>MTB_Robot#0</em>):<br/>
</p>
<p align="center"><img src="images/robLangTut3.jpg"/></p>
<br/>
<p>If the related plugin was found, then the the MTB plugin will launch a server application (i.e. <em>mtbServer</em>) that basically represents the robot language interpreter and controller. There is no direct need for a server application, the mtbServer functionality could also be directly running inside of the MTB plugin. The main advantages of using that functionality inside of a server application are:</p>
<li>The MTB plugin can act as intermediate for as many different languages as needed, also those that haven't been developed yet: the MTB plugin will simply launch the appropriate server depending on the used robot/language.</li>
<li>If the robot language interpreter / controller crashes, CoppeliaSim won't crash, since the two are distinct and separate processes.</li>
<p>Currently, the MTB server is in charge of two main tasks:</p>
<li>receive the program code (i.e. a buffer) from the MTB plugin, compile it, and initialize the robot controller.</li>
<li>apply input signals, step through the program code (the step duration can be different from step to step), and return output signals and joint angles. </li>
<p>If the MTB server detects an error during compilation of the program code, it will return an error message to the plugin, that will hand it over to the calling <a href="childScripts.htm">child script</a> (i.e. in our case, the child scripts attached to objects <em>MTB_Robot</em> and <em>MTB_Robot#0</em>.), which will display (for example):<br/>
</p>
<p align="center"><img src="images/robLangTut4.jpg"/></p>
<br/>
<p>If the compilation was successful, then the robots start executing their respective program. The simulation is a <em>maximum speed</em> simulation, but can  be switched to real-time simulation by toggling the related toolbar button:</p>
<p align="center"><img src="images/realTimeButton.jpg"/></p>
<p> The execution speed can be even more accelerated by pressing the appropriate toolbar button several times:</p>
<p align="center"><img src="images/simulationAcceleration.jpg"/></p>
<p>Each  MTB robot  program can be individually paused, stopped or restarted at any time via their displayed custom dialog, which are <a href="customUIPlugin.htm">custom user interfaces</a>:<br/>
</p>
<p align="center"><img src="images/robLangTut5.jpg"/></p>
<br/>
<p>Above custom UI is the user-interface of the MTB robot and can be fully customized. Should the MTB robot be copied, then its custom UI will also be copied. Next to being able to controlling the program execution state, the custom UI also displays current program line (<em>Command</em>) and the MTB's current joint values. The user can also change the robot's input port bits, and read the robot's output port bits. Input and output ports can be read and respectively written by the robot language program. Input and output ports can also be written and read by external devices (e.g. the robot's gripper or suction pad) by using appropriate function calls (see further below).<br/>
</p>
<p>There are two  child scripts attached to the <em>MTB_Robot</em> and <em>MTB_Robot#0</em> objects. They are in charge of handling the custom dialogs and communicating with the MTB plugin. Most code in the child scripts could be handled by the plugin too. Open the child script attached to one of the two MTB robot (e.g. with a double-click on the script icon next to the robot model in the scene hierarchy). At the top of the script, you will see the robot language code.<br/>
</p>
<p>Try to modify an MTB robot's program to have it perform a different movement sequence. Experiment a little bit.</p>
<p>The MTB robots are handled in following way:</p>
<li>
the actual robot language program is compiled and executed by the "mtbServer" application. That application also holds the MTB robot's state variables. For each MTB robot in the simulation scene, there will be an instance of the <em>mtbServer</em> application launched by the <em>simExtMTB</em> plugin.
</li>
<li>
the <em>simExtMTB</em> plugin is in charge of providing custom script functions, and  also  launches the <em>mtbServer</em> application when needed, and communicates with it via socket communication.</li>
<li>
the child scripts attached to <em>MTB_Robot</em> and <em>MTB_Robot#0</em> check whether the <em>simExtMTB</em> plugin is loaded and handle the communication with the plugin. </li>
<p>The MTB robot and its simple robot language is a simple prototype meant to demonstrate how to integrate a robot language interpreter into CoppeliaSim. It is very easy to extend current functionality for much more complex robots or robot languages. All what is needed is:<br/>
</p>
<li>Building the <a href="models.htm">model</a> of the robot. This includes <a href="importExport.htm">importing CAD data</a>, adding <a href="joints.htm">joints</a>, etc. This step can be entirely done in CoppeliaSim.<br/>
</li>
<li>Writing a <a href="plugins.htm">plugin</a> to handle the new robot natively, i.e. to handle the new robot by interpreting its own robot language. Any language capable of accessing C-API functions and capable of being wrapped in a dll can be used to create the plugin (but c/c++ is preferred). The robot language interpreter could be directly embedded in the plugin, or launched as an external application (<em>mtbServer</em>) as is done in this tutorial.<br/>
</li>
<li>Writing a small <a href="childScripts.htm">child script</a> responsible for handling <a href="customUIPlugin.htm">custom dialogs</a> and linking the robot with the plugin. This step can be entirely done in CoppeliaSim.<br/>
</li>
<p>Now let's have a look at the MTB's plugin project. There is one prerequisites to embedding a robot language interpreter (or other emulator) into CoppeliaSim:<br/>
</p>
<li>The robot language interpreter should be able to be executed several times in parallel. This means that several interpreter instances should be supported, in order to support several identical, in-parallel operating robots. This can be handled the easiest by launching a new interpreter for each new robot, as is done in this tutorial.<br/>
</li>
<p>When writing any plugin, make sure that the plugin accesses CoppeliaSim's <a href="apiFunctions.htm">regular API</a> only from the main thread (or from a thread created by CoppeliaSim)! The plugin can launch new threads, but in that case those new threads should not be used to access CoppeliaSim (they can however be used to communicate with a server application, to communicate with some hardware, to execute background calculations, etc.).</p>
<br/>
<p>Now let's have a look at the child script that is attached to the MTB robot. The code might seem quite long or complicated. However most functionality handled in the child script could also be directly handled in the plugin, making the child script much smaller/cleaner. The advantage in handling most functionality in the child script is that modifications can be performed without having to recompile the plugin!<br/>
</p>
<p>Following is the MTB robot's child script main functionality:<br/>
</p>
<li>
Checking whether the plugin was loaded. If not, an error message is output.</li>
<li>Communicating with the plugin. This means that information is sent to and received from the MTB plugin with custom script functions.<br/>
</li>
<li>Applying the newly calculated joint values to the MTB robot model. This could also be handled in the MTB's plugin.<br/>
</li>
<li>Reacting to events on the custom dialogs, like button presses.</li>
<li>Updating the state of the custom dialogs.<br/>
</li>
<p>Following 3 custom script functions are of main interest (others are exported by the plugin): <br/>
</p>
<code class="hljs language-lua coppelia-coppeliasim-script">
int mtbServerHandle,string message=simMTB.startServer(string mtbServerExecutable,
    int portNumber,charBuffer program,table[4] jointPositions, table[2] velocities)</code>
<code class="hljs language-lua coppelia-coppeliasim-script">
int result,string message=simMTB.step(int mtbServerHandle,float timeStep)</code>
<code class="hljs language-lua coppelia-coppeliasim-script">
table[4] jointValues=simMTB.getJoints(int mtbServerHandle)</code>
<li><strong>simMTB.startServer</strong>: launches the server application (e.g. <em>mtbServer</em>) on the specified port, connects to it, and sends it the robot language code, the initial linear/angular joint positions, and the initial velocities. In return, the function returns a server handle (if successful), and a message (usually a compilation error message).</li>
<li><strong>simMTB.step</strong>: steps through the robot language program with the specified timeStep, and returns a result value and a message (usually the code being currently executed).</li>
<li><strong>simMTB.getJoints</strong>: retrieves the current linear/angular joint positions. The linear/angular joint positions are automatically updated when <em>simMTB.step</em> is called.</li>
<p>You could also imagine slightly modifying the step function, and add one additional function, in order to be able to handle intermediate events triggered by the robot language program execution. In that case, each simulation step would have to execute following script code (in a child script):<br/>
</p>
<code class="hljs language-lua coppelia-coppeliasim-script">
local dt=sim.getSimulationTimeStep()
while (dt&gt;0) do
    result,dt,cmdMessage=simMTB.step(mtbServerHandle,dt) -- where the returned dt is the remaining dt
    local event=simMTB.getEvent()
    while event~=-1 do
        -- handle events here
        event=simMTB.getEvent()
    end
end</code>
<br/>
<br/>
</td></tr>
</table>
</div><br />Plugin tutorial << <a href='Plugin tutorial.html'>Previous</a> <a href='ROS tutorials.html'>Next</a> >> ROS tutorials</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        